* ArthurSlog
* SLog-2
* YearÂ·1

* GuangzhouÂ·China
* July 8th 2018
![å…³æ³¨å¾®ä¿¡å…¬ä¼—å·â€œç¯æ¸¸çš„çƒâ€](https://github.com/BlessedChild/LogofAxu/blob/master/images/icon_128.jpg?raw=true "å¾®ä¿¡æ‰«æäºŒç»´ç ï¼Œå…³æ³¨æˆ‘çš„å…¬ä¼—å·")

æƒ³è®©åˆ«äººæ‹‰ä½ ä¸€æŠŠï¼Œä½ çš„æ‰‹åœ¨å“ªï¼Ÿåˆ«æƒ³ç€æ‹‰åˆ«äººä¸€æŠŠï¼Œå¦åˆ™ä½ ä¹Ÿä¼šè¢«æ‹–å®ã€‚

### å¼€å‘ç¯å¢ƒMacOS
Macè‡ªå¸¦çš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥ç›´æ¥ç¼–è¯‘Cè¯­è¨€çš„ä»£ç ã€‚æ‰€ä»¥ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„æ‰‹æœºï¼Œè®¡æ—¶5åˆ†é’Ÿï¼Œ[ç¼–è¯‘å™¨](https://zh.wikipedia.org/wiki/ç·¨è­¯å™¨)äº†è§£ä¸€ä¸‹

æœ‰ç‚¹å¸¸è¯† æœ€åŸå§‹çš„ä¿¡æ¯ä¸€èˆ¬éƒ½æ˜¯æœ€æœ‰æ•ˆçš„ä¿¡æ¯

å¦‚æœé¢å‘ç™¾åº¦æˆ–è€…QQç¼–ç¨‹ï¼Œé‚£è¶æ—©è½¬è¡Œ

åœ¨Mysqlçš„å®˜ç½‘è·å–Cä¸Mysqlçš„äº¤äº’æ‰‹å†Œ[Mysqlå®˜æ–¹æ‰‹å†Œ](https://dev.mysql.com/doc/refman/8.0/en/c-api.html)

* ä¸‹é¢è¿™æ®µè¯æ˜¯æ™ºå•†çš„åˆ†æ°´å²­

The MySQL C API is a C-based API that client applications written in C can use to communicate with MySQL Server.Client programs refer to C API header files at compile time and link to a C API library file, libmysqlclient, at link time.

* è¿™æ®µè¯å°±æ˜¯å®ç°Cä¸Mysqlæ•°æ®äº¤äº’çš„å…³é”® å¦‚æœä½ çœ‹ä¸æ‡‚ è¯´æ˜ä½ æƒ³çš„å¤ªå¤š åšçš„å¤ªå°‘

### æé†’ï¼šå½“ä½ æƒ³è¿›æ­¥çš„æ—¶å€™ï¼Œç¬¬ä¸€æ—¶é—´æ‰“å¼€å®˜æ–¹æ‰‹å†Œ
å®˜æ–¹æ–‡æ¡£ä¸€èˆ¬éƒ½ä¸ä¼šè€ƒè™‘èœé¸Ÿä»¬çš„é˜…è¯»æ„Ÿå— æ‰€ä»¥ ä½œä¸ºä¸€åªğŸ™ƒèœé¸Ÿ è¦æœ‰ç‚¹çµæ€§

ä¸‹é¢æ˜¯åœ¨MySQLå®˜ç½‘æ‰¾åˆ°çš„ä¸€ä¸ªå…·ä½“çš„è°ƒç”¨æµç¨‹ï¼š

* step1 åˆå§‹åŒ–MySQLå®¢æˆ·ç«¯åº“ï¼Œmysql_library_init()ã€‚

* step2 åˆå§‹åŒ–MySQLå¯¹è±¡ï¼Œmysql_init()ï¼›å¹¶è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œ mysql_real_connect()ã€‚

* step3 å‘å‡ºSQLè¯­å¥å¹¶å¤„ç†å…¶ç»“æœï¼Œmysql_eqery()ã€‚

* step4 å…³é—­ä¸MySQLæœåŠ¡å™¨çš„è¿æ¥ï¼Œmysql_close()ã€‚

* step5 ç»“æŸä½¿ç”¨MySQLå®¢æˆ·ç«¯åº“ï¼Œmysql_library_end()ã€‚

ä¸‹é¢main.cæ˜¯å®Œæ•´çš„Cä»£ç ï¼ˆ1åˆ†é’Ÿæµè§ˆä¸€ä¸‹ï¼‰ï¼Œ å…³é”®æ˜¯ä¸Šé¢æåˆ°çš„äº”ä¸ªæ­¥éª¤ï¼Œå‡½æ•°çš„ç”¨æ³•å‚è€ƒ[Mysqlå®˜æ–¹æ‰‹å†Œ](https://dev.mysql.com/doc/refman/8.0/en/c-api-function-overview.html)

main.c
``` c
#include <stdio.h>
#include <mysql.h>
#include <stdlib.h>

MYSQL mysql;
MYSQL_RES *result;
MYSQL_ROW row;
unsigned int num_fields;
unsigned int i;
const char host_name[] = "localhost";
const char user_name[] = "root";
const char password[] = "888888";
const char db_name[] = "my_db";
unsigned int port_num = 0;
unsigned long CLIENT_MULTI_STATMENTS = 0;

int main(void)
{
    /* step1 int mysql_library_init(int argc, char **argv, char **groups) */
    if (mysql_library_init(0, NULL, NULL))
    {
        fprintf(stderr, "could not initialize MySQL client library\n");
        exit(1);
    }

    /* step2 MYSQL *mysql_init(MYSQL *mysql) */
    mysql_init(&mysql);

    /* step2 MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag) */
    if (mysql_real_connect(&mysql, host_name, user_name, password,
                           db_name, port_num, NULL, CLIENT_MULTI_STATEMENTS) == NULL)
    {
        printf("mysql_real_connect() failed\n");
        fprintf(stderr, "Failed to connect to database: Error: %s\n", mysql_error(&mysql));
        mysql_close(&mysql);
        exit(1);
    }

    /* step3 int mysql_query(MYSQL *mysql, const char *stmt_str) */
    int status = mysql_query(&mysql, "SELECT * FROM Account"); /* int mysql_query(MYSQL *mysql, const char *stmt_str) */

    if (status)
    {
        printf("Could not execute statement(s)");
        mysql_close(&mysql);
        exit(0);
    }

    /* process each statement result */
    do
    {
        /* did current statement return data? */
        /* MYSQL_RES *mysql_store_result(MYSQL *mysql) */
        result = mysql_store_result(&mysql);
        if (result)
        {
            /* unsigned int mysql_num_fields(MYSQL_RES *result) */
            num_fields = mysql_num_fields(result);
            /* MYSQL_ROW mysql_fetch_row(MYSQL_RES *result) */
            while ((row = mysql_fetch_row(result)))
            {
                unsigned long *lengths;
                lengths = mysql_fetch_lengths(result);
                for (i = 0; i < num_fields; i++)
                {
                    printf("[%.*s] ", (int)lengths[i],
                           row[i] ? row[i] : "NULL");
                }
                printf("\n");
            }
            /* yes; process rows and free the result set */
            /* process_result_set(mysql, result); */
            mysql_free_result(result) /* void mysql_free_result(MYSQL_RES *result) */;
        }
        else /* no result set or error*/
        {
            /* unsigned int mysql_field_count(MYSQL *mysql) */
            if (mysql_field_count(&mysql) == 0)
            {
                printf("lld rows affected\n");
                break;
            }
        }
        /* more results? -1 = no, >0 = error, 0 = yes (keep looping) */
        if ((status = mysql_next_result(&mysql)) > 0) /* int mysql_next_result(MYSQL *mysql) */
        {
            printf("Counld not execute statement\n");
        }
    } while (status == 0);

    /* step4 void mysql_close(MYSQL *mysql) */
    mysql_close(&mysql);

    /* step5 void mysql_library_end(void) */
    mysql_library_end();

    return EXIT_SUCCESS;
}
```

* è‹±æ–‡çœ‹ä¸æ‡‚? 
* [googleç¿»è¯‘](https://translate.google.cn)ï¼Œ [chrome](https://www.google.com/chrome/) ï¼Œ[å­—å…¸](https://item.jd.com/12987669974.html) äº†è§£ä¸€ä¸‹

* æµç¨‹ä»£ç åˆ†5ä¸ªstep

main.c
``` c
    /* step1 int mysql_library_init(int argc, char **argv, char **groups) */
    if (mysql_library_init(0, NULL, NULL))
    {
        fprintf(stderr, "could not initialize MySQL client library\n");
        exit(1);
    }

    /* step2 MYSQL *mysql_init(MYSQL *mysql) */
    mysql_init(&mysql);
    /* step2 MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag) */
    if (mysql_real_connect(&mysql, host_name, user_name, password,
                           db_name, port_num, NULL, CLIENT_MULTI_STATEMENTS) == NULL)
    {
        printf("mysql_real_connect() failed\n");
        fprintf(stderr, "Failed to connect to database: Error: %s\n", mysql_error(&mysql));
        mysql_close(&mysql);
        exit(1);
    }

    /* step3 int mysql_query(MYSQL *mysql, const char *stmt_str) */
    int status = mysql_query(&mysql, "SELECT * FROM Account"); /* int mysql_query(MYSQL *mysql, const char *stmt_str) */
    if (status)
    {
        printf("Could not execute statement(s)");
        mysql_close(&mysql);
        exit(0);
    }

    /* step4 void mysql_close(MYSQL *mysql) */
    mysql_close(&mysql);

    /* step5 void mysql_library_end(void) */
    mysql_library_end();
```

* è¿™é‡Œé¢æ¶‰åŠåˆ°çš„Cè¯­æ³•ï¼Œgoogleäº†è§£ä¸€ä¸‹

* ä¸Šé¢çš„ä»£ç èµ°å®Œä¸€ä¸ªæµç¨‹å°±ç®—å®Œäº†ï¼Œä½†å®é™…æƒ…å†µæ˜¯éœ€è¦â€˜å¢åˆ æ”¹æŸ¥â€™
* So

main.c
``` c
    /* process each statement result */
    do
    {
        /* did current statement return data? */
        /* MYSQL_RES *mysql_store_result(MYSQL *mysql) */
        result = mysql_store_result(&mysql);
        if (result)
        {
            /* unsigned int mysql_num_fields(MYSQL_RES *result) */
            num_fields = mysql_num_fields(result);
            /* MYSQL_ROW mysql_fetch_row(MYSQL_RES *result) */
            while ((row = mysql_fetch_row(result)))
            {
                unsigned long *lengths;
                lengths = mysql_fetch_lengths(result);
                for (i = 0; i < num_fields; i++)
                {
                    printf("[%.*s] ", (int)lengths[i],
                           row[i] ? row[i] : "NULL");
                }
                printf("\n");
            }
            /* yes; process rows and free the result set */
            /* process_result_set(mysql, result); */
            mysql_free_result(result) /* void mysql_free_result(MYSQL_RES *result) */;
        }
        else /* no result set or error*/
        {
            /* unsigned int mysql_field_count(MYSQL *mysql) */
            if (mysql_field_count(&mysql) == 0)
            {
                printf("lld rows affected\n");
                break;
            }
        }
        /* more results? -1 = no, >0 = error, 0 = yes (keep looping) */
        if ((status = mysql_next_result(&mysql)) > 0) /* int mysql_next_result(MYSQL *mysql) */
        {
            printf("Counld not execute statement\n");
        }
    } while (status == 0);
```
* æ ¹æ®Mysqlå®˜æ–¹æ‰‹å†Œ
* åœ¨ä»£ç é—´ï¼Œå½“ä¸€ä¸ªå‡½æ•°æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œè¿™ä¸ªç»“æœçš„æ•°æ®ç»“æ„å„ä¸ç›¸åŒï¼Œå‚è€ƒ[Mysqlå®˜æ–¹æ‰‹å†Œ](https://dev.mysql.com/doc/refman/8.0/en/c-api-function-overview.html)
* ä¸¾ä¸ªä¾‹å­æ —å­ï¼š

main.c
``` c
mysql_library_init()
```
* å®Œæ•´çš„å†™æ³•

main.c
``` c
int mysql_library_init(int argc, char **argv, char **groups)
```
* ç¬¬ä¸€ä¸ª intï¼Œä»£è¡¨çš„å°±æ˜¯è¿”å›å€¼çš„æ•°æ®ç»“æ„
* å¦‚æœè¦å‚¨å­˜è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œè¿”å›çš„å€¼ï¼Œéœ€è¦å£°æ˜ä¸€ä¸ªç›¸åŒçš„æ•°æ®ç»“æ„çš„å¯¹è±¡æ¥ä¿å­˜è¿™ä¸ªå€¼
* ä¸¾ä¸ªæ —å­ï¼š

main.c
``` c
int return_mli = null; //å£°æ˜ä¸€ä¸ªæ•°æ®ç»“æ„ä¸ºintçš„å¯¹è±¡ï¼Œå¹¶è®©reture_mliçš„å€¼ä¸ºç©º
```
* ç„¶åä½ å°±å¯ä»¥

main.c
``` c
int return_mli = null;
return_mli = mysql_library_init(0, NULL, NULL);
```
* æ­¤æ—¶ä½ å°±å¯ä»¥åˆ¤æ–­å‡½æ•°çš„è¿”å›å€¼ï¼Œä»¥ç¡®å®šæ¥ä¸‹æ¥è¦æ‰§è¡Œçš„æ“ä½œ
* C è¯­è¨€æŠŠä»»ä½•éé›¶å’Œéç©ºçš„å€¼å‡å®šä¸º trueï¼ŒæŠŠé›¶æˆ– null å‡å®šä¸º falseã€‚

main.c
``` c
int return_mli = 0;
return_mli = mysql_library_init(0, NULL, NULL);

if(return_mli)
{
    do something
}
```

* æ˜ç™½äº†è¿™äº›ï¼Œå†æ¬¡çœ‹ä¸€ä¸‹å®Œæ•´çš„ä»£ç 

main.c
``` c
#include <stdio.h>
#include <mysql.h>
#include <stdlib.h>

MYSQL mysql;
MYSQL_RES *result;
MYSQL_ROW row;
unsigned int num_fields;
unsigned int i;
const char host_name[] = "localhost";
const char user_name[] = "root";
const char password[] = "888888";
const char db_name[] = "my_db";
unsigned int port_num = 0;
unsigned long CLIENT_MULTI_STATMENTS = 0;

int main(void)
{
    /* step1 int mysql_library_init(int argc, char **argv, char **groups) */
    if (mysql_library_init(0, NULL, NULL))
    {
        fprintf(stderr, "could not initialize MySQL client library\n");
        exit(1);
    }

    /* step2 MYSQL *mysql_init(MYSQL *mysql) */
    mysql_init(&mysql);

    /* step2 MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag) */
    if (mysql_real_connect(&mysql, host_name, user_name, password,
                           db_name, port_num, NULL, CLIENT_MULTI_STATEMENTS) == NULL)
    {
        printf("mysql_real_connect() failed\n");
        fprintf(stderr, "Failed to connect to database: Error: %s\n", mysql_error(&mysql));
        mysql_close(&mysql);
        exit(1);
    }

    /* step3 int mysql_query(MYSQL *mysql, const char *stmt_str) */
    int status = mysql_query(&mysql, "SELECT * FROM Account"); /* int mysql_query(MYSQL *mysql, const char *stmt_str) */

    if (status)
    {
        printf("Could not execute statement(s)");
        mysql_close(&mysql);
        exit(0);
    }

    /* process each statement result */
    do
    {
        /* did current statement return data? */
        /* MYSQL_RES *mysql_store_result(MYSQL *mysql) */
        result = mysql_store_result(&mysql);
        if (result)
        {
            /* unsigned int mysql_num_fields(MYSQL_RES *result) */
            num_fields = mysql_num_fields(result);
            /* MYSQL_ROW mysql_fetch_row(MYSQL_RES *result) */
            while ((row = mysql_fetch_row(result)))
            {
                unsigned long *lengths;
                lengths = mysql_fetch_lengths(result);
                for (i = 0; i < num_fields; i++)
                {
                    printf("[%.*s] ", (int)lengths[i],
                           row[i] ? row[i] : "NULL");
                }
                printf("\n");
            }
            /* yes; process rows and free the result set */
            /* process_result_set(mysql, result); */
            mysql_free_result(result) /* void mysql_free_result(MYSQL_RES *result) */;
        }
        else /* no result set or error*/
        {
            /* unsigned int mysql_field_count(MYSQL *mysql) */
            if (mysql_field_count(&mysql) == 0)
            {
                printf("lld rows affected\n");
                break;
            }
        }
        /* more results? -1 = no, >0 = error, 0 = yes (keep looping) */
        if ((status = mysql_next_result(&mysql)) > 0) /* int mysql_next_result(MYSQL *mysql) */
        {
            printf("Counld not execute statement\n");
        }
    } while (status == 0);

    /* step4 void mysql_close(MYSQL *mysql) */
    mysql_close(&mysql);

    /* step5 void mysql_library_end(void) */
    mysql_library_end();

    return EXIT_SUCCESS;
}
```

* æ¥ä¸‹æ¥åˆ‡æ¢è‡³ä»£ç è·¯å¾„ä¸‹
* æ‰§è¡Œç¼–è¯‘æŒ‡ä»¤
> gcc -c main.c -I /usr/local/mysql/include
* æ‰§è¡Œé“¾æ¥æŒ‡ä»¤ï¼Œå¾—åˆ°æ‰§è¡Œæ–‡ä»¶main
> gcc main.o -o main -L /usr/local/mysql/lib -lmysqlclient
* æ­¤æ—¶å½“å‰è·¯å¾„ä¸‹æœ‰è¿™ä¸‰ä¸ªæ–‡ä»¶

``` c
main.c main.o main
```

* å¯åŠ¨å¯æ‰§è¡Œæ–‡ä»¶main
> ./main

* æ­¤æ—¶ä¼šæç¤ºå‡ºé”™ï¼Œè§£å†³åŠæ³•ç¬¬ä¸€æ—¶é—´åº”è¯¥æƒ³åˆ°çš„æ˜¯[Mysqlå®˜æ–¹æ‰‹å†Œ](https://dev.mysql.com/doc/refman/8.0/en/c-api-running-clients.html)
* æ ¹æ®å®˜æ–¹æä¾›çš„ä¿¡æ¯ï¼Œå¯ä»¥æ¨æ–­æ˜¯ç³»ç»Ÿé“¾æ¥çš„é—®é¢˜ã€‚googleå¯å¾—ï¼Œç”±äºMacOSç³»ç»Ÿçš„ä¿æŠ¤æœºåˆ¶ï¼Œè§£å†³æ–¹å¼å¦‚ä¸‹ï¼š
> ln -s /usr/local/mysql/lib/libmysqlclient.21.dylib /usr/local/lib/libmysqlclient.21.dylib

* æœ€åï¼Œå¯åŠ¨å¯æ‰§è¡Œæ–‡ä»¶main
> ./main

* å‰ææ˜¯ä½ é…ç½®å¥½äº†æ•°æ®åº“å‚æ•°ï¼Œä¸‹é¢æ˜¯æˆ‘è‡ªå·±é…ç½®çš„æ•°æ®åº“ä¿¡æ¯

``` c
const char host_name[] = "localhost";
const char user_name[] = "root";
const char password[] = "888888";
const char db_name[] = "my_db";

int status = mysql_query(&mysql, "SELECT * FROM Account"); /* int mysql_query(MYSQL *mysql, const char *stmt_str) */
```

* SQLè¯­æ³•ä¸æ‡‚ï¼Ÿ[SQLæ‰‹å†Œ](https://www.w3schools.com/sql/)äº†è§£ä¸€ä¸‹

``` c
SELECT * FROM Account
```

* è‡³æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨Cè¯­è¨€ä¸MySQLæ•°æ®åº“æˆåŠŸå®ç°äº†æ•°æ®äº¤äº’ã€‚

### æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å· ArthurSlog

![ArthurSlog](https://github.com/BlessedChild/LogofAxu/blob/master/images/icon_128.jpg?raw=true "å¾®ä¿¡æ‰«æäºŒç»´ç ï¼Œå…³æ³¨æˆ‘çš„å…¬ä¼—å·")

### å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç«  æ¬¢è¿ç‚¹èµ ç•™è¨€
### è°¢è°¢